<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#0a0a1a" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23FFD700' stroke='%23DAA520' stroke-width='5'/><circle cx='50' cy='50' r='30' fill='%23DAA520'/><text x='50' y='65' font-size='40' text-anchor='middle' fill='%23FFD700'>$</text></svg>" type="image/svg+xml">
    <title>Coin Pusher World</title>
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <div id="game-container">
      <canvas id="game-canvas"></canvas>

      <!-- UI Overlay -->
      <div id="ui-overlay">
        <!-- Score Display -->
        <div id="score-display">
          <span id="score-label">Score:</span>
          <span id="score-value">0</span>
        </div>

        <!-- Coin Queue Display -->
        <div id="queue-display">
          <span id="queue-label">Queue:</span>
          <span id="queue-value">0</span>
          <!-- Queue Regeneration Progress (Design Spec 9.1 - visual feedback) -->
          <div id="queue-regen-bar" class="queue-regen-bar">
            <div id="queue-regen-fill" class="queue-regen-fill"></div>
          </div>
        </div>

        <!-- Tier Indicator -->
        <div id="expansion-display">
          <span id="expansion-label">Tier:</span>
          <span id="expansion-value">1</span>
        </div>

        <!-- Board Counter (Pyramid Status) -->
        <div id="board-counter-display">
          <span id="board-counter-label">Boards:</span>
          <span id="board-counter-value">1 / 8</span>
        </div>

        <!-- Tier Progress Bar -->
        <div id="tier-progress-container">
          <div id="tier-progress-bar">
            <div id="tier-progress-fill"></div>
          </div>
          <span id="tier-progress-label">Next: 10K</span>
        </div>

        <!-- Auto-Save Indicator (Phase 9 - visual feedback for auto-save) -->
        <div id="autosave-indicator" class="hidden">
          <span class="autosave-icon">üíæ</span>
          <span class="autosave-text">Game Saved</span>
        </div>

        <!-- Active Prizes Display (Phase 8 Polish - real-time prize feedback) -->
        <div id="active-prizes-panel" class="hidden">
          <div class="active-prizes-header">Active Bonuses</div>
          <div id="active-prizes-list" class="active-prizes-list">
            <!-- Prize items will be added dynamically -->
          </div>
        </div>
      </div>

      <!-- Stats Button -->
      <button id="stats-button">STATS</button>

      <!-- Drop Button -->
      <button id="drop-button">DROP COIN</button>

      <!-- Auto-Drop Toggle Button -->
      <button id="auto-drop-button">AUTO: OFF</button>

      <!-- Multi-Drop Button (Design Spec 5.4 - multiDrop powerupFocus) -->
      <div id="multi-drop-ready-indicator" class="hidden">READY!</div>
      <button id="multi-drop-button" class="hidden" disabled>MULTI-DROP</button>

      <!-- Multi-Drop Gauge (Design Spec 5.4) -->
      <div id="multi-drop-gauge" class="hidden">
        <div class="gauge-label">MULTI-DROP</div>
        <div class="gauge-bar">
          <div id="multi-drop-fill" class="gauge-fill"></div>
        </div>
        <div id="multi-drop-count" class="gauge-count">0/10</div>
      </div>

      <!-- Help Button -->
      <button id="help-button">?</button>

      <!-- Settings Button -->
      <button id="settings-button">SETTINGS</button>

      <!-- Settings Overlay -->
      <div id="settings-overlay" class="hidden">
        <div class="settings-content">
          <div class="settings-header">
            <h2>Settings</h2>
          </div>

          <div class="settings-section">
            <h3>Audio</h3>

            <div class="setting-row">
              <label for="master-volume">Master Volume</label>
              <div class="slider-container">
                <input type="range" id="master-volume" min="0" max="100" value="60" class="volume-slider">
                <span id="master-volume-value" class="volume-value">60%</span>
              </div>
            </div>

            <div class="setting-row">
              <label for="music-volume">Music Volume</label>
              <div class="slider-container">
                <input type="range" id="music-volume" min="0" max="100" value="40" class="volume-slider">
                <span id="music-volume-value" class="volume-value">40%</span>
              </div>
            </div>

            <div class="setting-row">
              <label for="sfx-volume">Sound Effects</label>
              <div class="slider-container">
                <input type="range" id="sfx-volume" min="0" max="100" value="70" class="volume-slider">
                <span id="sfx-volume-value" class="volume-value">70%</span>
              </div>
            </div>

            <div class="setting-row toggle-row">
              <label for="music-toggle">Music</label>
              <button id="music-toggle" class="toggle-button active">ON</button>
            </div>

            <div class="setting-row toggle-row">
              <label for="sfx-toggle">Sound Effects</label>
              <button id="sfx-toggle" class="toggle-button active">ON</button>
            </div>
          </div>

          <div class="settings-section">
            <h3>Performance</h3>

            <div class="setting-row toggle-row">
              <label for="performance-toggle">Low Performance Mode</label>
              <button id="performance-toggle" class="toggle-button">OFF</button>
            </div>

            <div class="setting-info">
              <p>Enable this on older devices to improve frame rate. Reduces max coins and particle effects.</p>
            </div>
          </div>

          <div class="settings-section">
            <h3>Data Management</h3>

            <div class="setting-row">
              <button id="export-save-button" class="action-button">Export Save Data</button>
            </div>

            <div class="setting-row">
              <label for="import-save-file" class="action-button">
                Import Save Data
                <input type="file" id="import-save-file" accept=".json" style="display: none;">
              </label>
            </div>

            <div class="setting-row">
              <button id="reset-high-scores-button" class="action-button danger-button">Reset High Scores</button>
            </div>

            <div class="setting-row">
              <button id="clear-saved-game-button" class="action-button danger-button">Clear Saved Game</button>
            </div>

            <div class="setting-info">
              <p>Backup your progress or restore from a previous save file.</p>
              <p class="warning-text">‚ö†Ô∏è Resetting high scores or clearing saved game is permanent and cannot be undone!</p>
            </div>
          </div>

          <button id="close-settings">CLOSE</button>
        </div>
      </div>

      <!-- Stats Overlay -->
      <div id="stats-overlay" class="hidden">
        <div class="stats-content">
          <div class="stats-header">
            <h2>Game Stats</h2>
          </div>
          <div class="stats-grid" id="stats-grid">
            <!-- Stats will be populated by JS -->
          </div>
          <button id="close-stats">CLOSE</button>
        </div>
      </div>

      <!-- Board Stats Overlay (Design Spec 2.2 - Skill Expression) -->
      <div id="board-stats-overlay" class="hidden">
        <div class="board-stats-content">
          <div class="board-stats-header">
            <h2>Board Performance</h2>
            <p>Strategic insights for better board placement</p>
          </div>
          <div class="board-stats-list" id="board-stats-list">
            <!-- Board stats will be populated by JS -->
          </div>
          <button id="close-board-stats">CLOSE</button>
        </div>
      </div>

      <!-- Start Screen -->
      <div id="start-screen">
        <h1>Coin Pusher World</h1>
        <p>Drop coins through pegs and pushers to score big!</p>

        <div class="start-features">
          <div class="start-feature">
            <span class="start-feature-icon">üé∞</span>
            <span class="start-feature-text">Pachinko pegs + coin pushers</span>
          </div>
          <div class="start-feature">
            <span class="start-feature-icon">üåà</span>
            <span class="start-feature-text">8 unique themed worlds</span>
          </div>
          <div class="start-feature">
            <span class="start-feature-icon">üíé</span>
            <span class="start-feature-text">Collect rare coins & power-ups</span>
          </div>
          <div class="start-feature">
            <span class="start-feature-icon">üî•</span>
            <span class="start-feature-text">Build combos for big multipliers</span>
          </div>
        </div>

        <div class="start-controls">
          <h3>How to Play</h3>
          <p>Tap DROP COIN or press SPACE to drop coins</p>
          <p>Push coins off the edge to score points!</p>
        </div>

        <button id="start-button">START GAME</button>

        <div class="start-credits">
          <p>v1.0 &nbsp;|&nbsp; Built with three.js &nbsp;|&nbsp; ¬© 2025</p>
        </div>
      </div>

      <!-- Help Overlay -->
      <div id="help-overlay" class="hidden">
        <div class="help-content">
          <div class="help-header">
            <h2>How to Play</h2>
            <p>Master the coin pusher and unlock all worlds!</p>
          </div>

          <div class="help-section">
            <h3><span class="section-icon">üéÆ</span> Basic Controls</h3>
            <div class="help-item">
              <div class="help-item-icon">üëÜ</div>
              <div class="help-item-text">
                <h4>Drop Coins</h4>
                <p>Tap the DROP COIN button or press SPACEBAR to release coins from above.</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üìä</div>
              <div class="help-item-text">
                <h4>Queue System</h4>
                <p>Your coin queue refills automatically. Watch the Queue counter in the top left!</p>
              </div>
            </div>
          </div>

          <div class="help-section">
            <h3><span class="section-icon">‚å®Ô∏è</span> Keyboard Shortcuts</h3>
            <div class="help-item">
              <div class="help-item-icon">‚éµ</div>
              <div class="help-item-text">
                <h4>SPACE</h4>
                <p>Drop a coin (same as clicking DROP COIN button)</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üÖ∞</div>
              <div class="help-item-text">
                <h4>A</h4>
                <p>Toggle Auto-Drop ON/OFF</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üÖº</div>
              <div class="help-item-text">
                <h4>M</h4>
                <p>Trigger Multi-Drop (when gauge is full) - Drop 5+ coins at once!</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üÖ∑</div>
              <div class="help-item-text">
                <h4>H</h4>
                <p>Toggle this Help overlay</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üÖÇ</div>
              <div class="help-item-text">
                <h4>S</h4>
                <p>Open Settings menu</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üÖ±</div>
              <div class="help-item-text">
                <h4>B</h4>
                <p>View Board Performance statistics (strategic insights)</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">‚éã</div>
              <div class="help-item-text">
                <h4>ESC</h4>
                <p>Close any open overlay or menu</p>
              </div>
            </div>
          </div>

          <div class="help-section">
            <h3><span class="section-icon">üéØ</span> Scoring</h3>
            <div class="help-item">
              <div class="help-item-icon">ü™ô</div>
              <div class="help-item-text">
                <h4>Push Coins Off the Edge</h4>
                <p>Coins fall through pegs, then get pushed by the moving pusher. When they fall off the front edge into scoring slots, you earn points!</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">‚ú®</div>
              <div class="help-item-text">
                <h4>Multiplier Slots</h4>
                <p>Slots are labeled 2X, 3X, 5X, or 10X. Land coins in bonus slots for huge points and special rewards!</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üî•</div>
              <div class="help-item-text">
                <h4>Combos</h4>
                <p>Score coins quickly in succession to build combos. Higher combos = bigger multipliers!</p>
              </div>
            </div>
          </div>

          <div class="help-section">
            <h3><span class="section-icon">ü™ô</span> Coin Types</h3>
            <div class="help-item">
              <div class="help-item-icon">üü°</div>
              <div class="help-item-text">
                <h4>Gold Coins</h4>
                <p>Standard coins worth base value. Most common drop.</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">‚ö™</div>
              <div class="help-item-text">
                <h4>Silver Coins</h4>
                <p>Worth 50% of gold value. Common drop.</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üü§</div>
              <div class="help-item-text">
                <h4>Bronze Coins</h4>
                <p>Worth 25% of gold value. Common drop.</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üü£</div>
              <div class="help-item-text">
                <h4>Special Coins</h4>
                <p>Worth 5X gold value! Rare drop.</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üåà</div>
              <div class="help-item-text">
                <h4>Rainbow Coins</h4>
                <p>Worth 10X gold value! Very rare - increases with Lucky Coins upgrade.</p>
              </div>
            </div>
          </div>

          <div class="help-section">
            <h3><span class="section-icon">üéÅ</span> Prize System</h3>
            <div class="help-item">
              <div class="help-item-icon">üé∞</div>
              <div class="help-item-text">
                <h4>Prize Counter (6 Choices)</h4>
                <p>When you unlock a new board, the Prize Counter appears with 6 prizes. Choose 1 to add to your run! You can hold up to 8 active prizes.</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">‚ú®</div>
              <div class="help-item-text">
                <h4>Prize Rarities</h4>
                <p>Common (gray), Uncommon (green), Rare (blue), Epic (purple), Legendary (gold). Rarer prizes = stronger effects!</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üíé</div>
              <div class="help-item-text">
                <h4>Prize Affinities</h4>
                <p>Prizes have affinities (synergies) with board themes. When you have matching themes, the prize glows green in the selection screen!</p>
              </div>
            </div>
            <div class="help-tip">
              <div class="help-tip-title">Pro Strategy</div>
              <p>Build synergistic engines! Example: Pick "Queue King" boards (Neon Arcade üïπÔ∏è, Candy Kingdom üç≠) + prizes with queueSpeed/queueCapacity affinity for auto-coin explosion!</p>
            </div>
          </div>

          <div class="help-section">
            <h3><span class="section-icon">‚ö°</span> Gameplay Systems</h3>
            <div class="help-item">
              <div class="help-item-icon">‚ö°</div>
              <div class="help-item-text">
                <h4>Queue System</h4>
                <p>Coins auto-drop from your queue. Faster drops with queueSpeed boards/prizes. Larger capacity with queueCapacity focus.</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üí∞</div>
              <div class="help-item-text">
                <h4>Coin Value Multipliers</h4>
                <p>Coins passing through coinValue boards (Dino Land ü¶ñ) gain permanent value increases. Stack multiple for exponential growth!</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üî•</div>
              <div class="help-item-text">
                <h4>Combo Chains</h4>
                <p>Score coins rapidly to build combos (up to 7x multiplier!). ComboTime boards (Jungle Safari ü¶Å) extend the window.</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üé∞</div>
              <div class="help-item-text">
                <h4>Jackpots</h4>
                <p>JackpotChance boards (Robot Factory ü§ñ) increase jackpot frequency and payouts. Watch for huge score bursts!</p>
              </div>
            </div>
          </div>

          <div class="help-section">
            <h3><span class="section-icon">üåç</span> Themed Worlds & Pyramid</h3>
            <div class="help-item">
              <div class="help-item-icon">üèÜ</div>
              <div class="help-item-text">
                <h4>Build an 8-Board Pyramid</h4>
                <p>Reach score thresholds to expand your pyramid up to 8 boards! Coins cascade through multiple boards, stacking multipliers as they go.</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üéØ</div>
              <div class="help-item-text">
                <h4>Theme Focus Matters</h4>
                <p>Each theme has a powerup focus: queueSpeed üïπÔ∏è, coinValue ü¶ñ, luckyCoins üëΩ, multiDrop üè¥‚Äç‚ò†Ô∏è, queueCapacity üç≠, widerPusher üöÄ, comboTime ü¶Å, jackpotChance ü§ñ</p>
              </div>
            </div>
            <div class="help-tip">
              <div class="help-tip-title">Pro Strategy</div>
              <p>Choose boards and prizes that synergize! Match prize affinities (highlighted in green) with your board themes for maximum power.</p>
            </div>
            <div class="help-tip">
              <div class="help-tip-title">Worlds to Discover</div>
              <p>Neon Arcade, Dino Land, Alien Invasion, Pirate Cove, Candy Kingdom, Space Station, Jungle Safari, Robot Factory</p>
            </div>
          </div>

          <div class="help-section">
            <h3><span class="section-icon">üé∞</span> Special Features</h3>
            <div class="help-item">
              <div class="help-item-icon">üíé</div>
              <div class="help-item-text">
                <h4>Jackpot Meter</h4>
                <p>Every coin scored fills the jackpot meter. When full, coins rain down for massive bonus points!</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">üåßÔ∏è</div>
              <div class="help-item-text">
                <h4>Coin Rain</h4>
                <p>Land in bonus slots to trigger coin rain rewards - instant coins, multipliers, and special bonuses!</p>
              </div>
            </div>
            <div class="help-item">
              <div class="help-item-icon">‚≠ê</div>
              <div class="help-item-text">
                <h4>Bonus Zones</h4>
                <p>Glowing circles on the shelf give bonus coins, multipliers, or trigger power-up selection!</p>
              </div>
            </div>
          </div>

          <button id="close-help">GOT IT!</button>
        </div>
      </div>

      <!-- Game Over Screen -->
      <div id="gameover-screen" class="hidden">
        <h1>Game Over</h1>
        <div id="high-score-info"></div>
        <p class="final-score-display">Final Score: <span id="final-score">0</span></p>
        <p id="best-score" class="best-score-display"></p>

        <!-- Session Stats -->
        <div id="session-stats" class="session-stats-grid">
          <div class="session-stat">
            <span class="stat-label">Coins Dropped</span>
            <span id="stat-coins-dropped" class="stat-value">0</span>
          </div>
          <div class="session-stat">
            <span class="stat-label">Coins Scored</span>
            <span id="stat-coins-scored" class="stat-value">0</span>
          </div>
          <div class="session-stat">
            <span class="stat-label">Best Combo</span>
            <span id="stat-best-combo" class="stat-value">0x</span>
          </div>
          <div class="session-stat">
            <span class="stat-label">Tier Reached</span>
            <span id="stat-tier" class="stat-value">1</span>
          </div>
        </div>

        <div class="gameover-buttons">
          <button id="restart-button">PLAY AGAIN</button>
          <button id="view-scores-button">HIGH SCORES</button>
        </div>
      </div>

      <!-- High Scores Overlay -->
      <div id="high-scores-overlay" class="hidden">
        <div class="high-scores-content">
          <div class="high-scores-header">
            <h2>High Scores</h2>
          </div>
          <div id="high-scores-list" class="high-scores-list">
            <!-- Scores populated by JS -->
          </div>
          <button id="close-high-scores">CLOSE</button>
        </div>
      </div>

      <!-- Tier Unlock Animation Overlay -->
      <div id="tier-unlock-overlay" class="hidden">
        <div class="tier-unlock-stars"></div>
        <div class="tier-unlock-content">
          <span class="tier-unlock-icon"></span>
          <div class="tier-unlock-text"></div>
        </div>
      </div>
    </div>

    <!-- Vite entry point (Three.js bundled via npm) -->
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
